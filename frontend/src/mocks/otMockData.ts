import type {
  OtAsset,
  OtCommunication,
  OtDetection,
  OtPcapJob,
  OtProtocol,
  OtSensor,
  OtSeverity,
} from "../types/ot";

const baseTime = Date.now();
const minutesAgo = (minutes: number) => new Date(baseTime - minutes * 60_000).toISOString();
const hoursAgo = (hours: number) => new Date(baseTime - hours * 3_600_000).toISOString();
const daysAgo = (days: number) => new Date(baseTime - days * 86_400_000).toISOString();

export const otSensors: OtSensor[] = [
  {
    id: "sensor-ot-01",
    name: "Sensor-OT-01",
    site: "HQ",
    zone: "Level 1",
    status: "online",
    lastSeen: minutesAgo(2),
    version: "1.4.2",
    capabilities: { zeek: true, icsnpp: true, acid: true, suricata: false },
    ingest: { method: "http", endpoint: "https://eventsec.local/ingest/ot-01" },
  },
  {
    id: "sensor-ot-02",
    name: "Sensor-OT-02",
    site: "HQ",
    zone: "Level 2",
    status: "degraded",
    lastSeen: minutesAgo(18),
    version: "1.3.9",
    capabilities: { zeek: true, icsnpp: true, acid: false },
    ingest: { method: "beats", endpoint: "beats://ingest/ot-02" },
  },
  {
    id: "sensor-ot-03",
    name: "Sensor-OT-03",
    site: "Plant West",
    zone: "Cell 3",
    status: "offline",
    lastSeen: hoursAgo(5),
    version: "1.2.7",
    capabilities: { zeek: true, icsnpp: false, acid: true, suricata: true },
    ingest: { method: "file" },
  },
  {
    id: "sensor-ot-04",
    name: "Sensor-OT-04",
    site: "Plant North",
    zone: "Packaging",
    status: "online",
    lastSeen: minutesAgo(6),
    version: "1.4.1",
    capabilities: { zeek: true, icsnpp: true, acid: true },
    ingest: { method: "http", endpoint: "https://eventsec.local/ingest/ot-04" },
  },
];

export const otAssets: OtAsset[] = [
  {
    id: "asset-plc-001",
    name: "PLC-001",
    ip: "192.168.10.12",
    mac: "00:1B:44:11:3A:B7",
    vendor: "Siemens",
    model: "S7-1500",
    firmware: "v2.8",
    assetType: "PLC",
    site: "HQ",
    zone: "Level 1",
    criticality: "high",
    firstSeen: daysAgo(10),
    lastSeen: minutesAgo(12),
    tags: ["Production", "Critical"],
  },
  {
    id: "asset-plc-002",
    name: "PLC-002",
    ip: "192.168.10.13",
    vendor: "Siemens",
    model: "S7-1200",
    assetType: "PLC",
    site: "HQ",
    zone: "Level 1",
    criticality: "med",
    firstSeen: daysAgo(8),
    lastSeen: minutesAgo(38),
    tags: ["Production"],
  },
  {
    id: "asset-hmi-009",
    name: "HMI-009",
    ip: "192.168.10.44",
    vendor: "Rockwell",
    model: "PanelView",
    assetType: "HMI",
    site: "HQ",
    zone: "Level 2",
    criticality: "med",
    firstSeen: daysAgo(12),
    lastSeen: minutesAgo(45),
    tags: ["Operator"],
  },
  {
    id: "asset-rtu-204",
    name: "RTU-204",
    ip: "10.40.22.8",
    vendor: "Schneider",
    model: "SCADAPack",
    assetType: "RTU",
    site: "Plant West",
    zone: "Cell 3",
    criticality: "high",
    firstSeen: daysAgo(20),
    lastSeen: hoursAgo(1),
    tags: ["Telemetry", "Remote"],
  },
  {
    id: "asset-eng-03",
    name: "ENG-WS-03",
    ip: "10.40.22.64",
    vendor: "Dell",
    model: "Precision",
    assetType: "Server",
    site: "Plant West",
    zone: "Engineering",
    criticality: "low",
    firstSeen: daysAgo(15),
    lastSeen: hoursAgo(2),
    tags: ["Maintenance"],
  },
  {
    id: "asset-switch-01",
    name: "OT-SW-01",
    ip: "192.168.10.2",
    vendor: "Cisco",
    model: "IE-4000",
    assetType: "Switch",
    site: "HQ",
    zone: "Level 1",
    criticality: "high",
    firstSeen: daysAgo(30),
    lastSeen: minutesAgo(9),
    tags: ["Core"],
  },
  {
    id: "asset-historian",
    name: "Historian",
    ip: "10.10.14.99",
    vendor: "OSIsoft",
    model: "PI Server",
    assetType: "Server",
    site: "HQ",
    zone: "Level 3",
    criticality: "high",
    firstSeen: daysAgo(18),
    lastSeen: minutesAgo(3),
    tags: ["Telemetry"],
  },
  {
    id: "asset-unknown-01",
    name: "Unknown-Device-01",
    ip: "192.168.10.90",
    assetType: "Unknown",
    site: "Plant North",
    zone: "Packaging",
    criticality: "low",
    firstSeen: daysAgo(1),
    lastSeen: minutesAgo(22),
    tags: ["Unclassified"],
  },
];

export const otDetections: OtDetection[] = [
  {
    id: "det-001",
    ts: minutesAgo(5),
    severity: "critical",
    status: "open",
    title: "PLC ladder logic modification",
    description: "Unexpected program logic change detected on PLC asset.",
    sensorId: "sensor-ot-01",
    assetIds: ["asset-plc-001", "asset-plc-002"],
    technique: {
      framework: "MITRE_ICS",
      tactic: "Impair Process Control",
      techniqueId: "T0849",
      techniqueName: "Program Logic Modification",
    },
    evidence: [
      { key: "Protocol", value: "Modbus" },
      { key: "Function", value: "Write Multiple Coils" },
      { key: "Source", value: "10.10.14.21" },
    ],
  },
  {
    id: "det-002",
    ts: minutesAgo(18),
    severity: "high",
    status: "in_progress",
    title: "Unauthorized firmware update",
    description: "Firmware update observed outside approved maintenance window.",
    sensorId: "sensor-ot-02",
    assetIds: ["asset-rtu-204"],
    technique: {
      framework: "MITRE_ICS",
      tactic: "Impair Process Control",
      techniqueId: "T0884",
      techniqueName: "Modify Controller Tasking",
    },
    evidence: [
      { key: "Protocol", value: "S7" },
      { key: "Asset", value: "RTU-204" },
      { key: "Delta", value: "Firmware 2.2 â†’ 2.3" },
    ],
  },
  {
    id: "det-003",
    ts: minutesAgo(46),
    severity: "med",
    status: "open",
    title: "New engineering workstation activity",
    description: "Engineering workstation accessed PLC outside business hours.",
    sensorId: "sensor-ot-01",
    assetIds: ["asset-eng-03", "asset-plc-001"],
    technique: {
      framework: "MITRE_ICS",
      tactic: "Collection",
      techniqueId: "T0851",
      techniqueName: "Monitor Process State",
    },
    evidence: [
      { key: "User", value: "eng_ops" },
      { key: "Source", value: "10.40.22.64" },
    ],
  },
  {
    id: "det-004",
    ts: hoursAgo(2),
    severity: "high",
    status: "open",
    title: "Suspicious Modbus write request",
    description: "Modbus write request from IT segment to OT controller.",
    sensorId: "sensor-ot-04",
    assetIds: ["asset-plc-002"],
    technique: {
      framework: "MITRE_ICS",
      tactic: "Impact",
      techniqueId: "T0869",
      techniqueName: "Modify Parameter",
    },
    evidence: [
      { key: "Source", value: "10.10.14.21" },
      { key: "Function", value: "Write Single Register" },
    ],
  },
  {
    id: "det-005",
    ts: hoursAgo(4),
    severity: "low",
    status: "closed",
    title: "New device in safety zone",
    description: "Previously unseen device detected in packaging cell.",
    sensorId: "sensor-ot-03",
    assetIds: ["asset-unknown-01"],
    technique: {
      framework: "MITRE_ICS",
      tactic: "Discovery",
      techniqueId: "T0883",
      techniqueName: "Network Service Scanning",
    },
    evidence: [
      { key: "MAC", value: "00:25:96:FF:FE:12" },
      { key: "Zone", value: "Packaging" },
    ],
  },
  {
    id: "det-006",
    ts: hoursAgo(6),
    severity: "med",
    status: "open",
    title: "Unexpected historian upload volume",
    description: "Spike in telemetry upload volume to historian.",
    sensorId: "sensor-ot-01",
    assetIds: ["asset-historian"],
    pcapJobId: "pcap-002",
    evidence: [
      { key: "Protocol", value: "OPCUA" },
      { key: "Bytes", value: "5.2 GB" },
    ],
  },
  {
    id: "det-007",
    ts: hoursAgo(9),
    severity: "high",
    status: "open",
    title: "Unauthorized OT switch configuration",
    description: "Switch configuration update detected from unknown host.",
    sensorId: "sensor-ot-04",
    assetIds: ["asset-switch-01"],
    evidence: [
      { key: "Protocol", value: "SSH" },
      { key: "Source", value: "10.10.14.55" },
    ],
  },
  {
    id: "det-008",
    ts: daysAgo(2),
    severity: "med",
    status: "closed",
    title: "Maintenance window access",
    description: "Observed access during scheduled maintenance.",
    sensorId: "sensor-ot-02",
    assetIds: ["asset-plc-001"],
    pcapJobId: "pcap-002",
    evidence: [
      { key: "User", value: "maintenance" },
      { key: "Window", value: "Scheduled" },
    ],
  },
];

export const otCommunications: OtCommunication[] = [
  {
    id: "comm-001",
    ts: minutesAgo(4),
    srcIp: "10.10.14.21",
    dstIp: "192.168.10.12",
    srcAssetId: "asset-eng-03",
    dstAssetId: "asset-plc-001",
    protocol: "Modbus",
    port: 502,
    direction: "IT->OT",
    summary: "Modbus read coils request",
    bytes: 1420,
    packets: 12,
  },
  {
    id: "comm-002",
    ts: minutesAgo(12),
    srcIp: "192.168.10.44",
    dstIp: "192.168.10.12",
    srcAssetId: "asset-hmi-009",
    dstAssetId: "asset-plc-001",
    protocol: "S7",
    port: 102,
    direction: "OT->OT",
    summary: "S7 PLC diagnostics",
    bytes: 980,
    packets: 8,
  },
  {
    id: "comm-003",
    ts: minutesAgo(24),
    srcIp: "192.168.10.12",
    dstIp: "10.10.14.99",
    srcAssetId: "asset-plc-001",
    dstAssetId: "asset-historian",
    protocol: "OPCUA",
    port: 4840,
    direction: "OT->IT",
    summary: "Telemetry upload to historian",
    bytes: 20480,
    packets: 120,
  },
  {
    id: "comm-004",
    ts: minutesAgo(36),
    srcIp: "192.168.10.13",
    dstIp: "192.168.10.44",
    srcAssetId: "asset-plc-002",
    dstAssetId: "asset-hmi-009",
    protocol: "BACnet",
    port: 47808,
    direction: "OT->OT",
    summary: "BACnet read property",
    bytes: 760,
    packets: 5,
  },
  {
    id: "comm-005",
    ts: hoursAgo(1),
    srcIp: "10.40.22.8",
    dstIp: "10.10.14.99",
    srcAssetId: "asset-rtu-204",
    dstAssetId: "asset-historian",
    protocol: "DNP3",
    port: 20000,
    direction: "OT->IT",
    summary: "DNP3 event report",
    bytes: 4020,
    packets: 24,
  },
  {
    id: "comm-006",
    ts: hoursAgo(2),
    srcIp: "10.10.14.21",
    dstIp: "192.168.10.13",
    srcAssetId: "asset-eng-03",
    dstAssetId: "asset-plc-002",
    protocol: "Modbus",
    port: 502,
    direction: "IT->OT",
    summary: "Modbus write register",
    bytes: 1200,
    packets: 9,
  },
  {
    id: "comm-007",
    ts: hoursAgo(2),
    srcIp: "192.168.10.2",
    dstIp: "192.168.10.12",
    srcAssetId: "asset-switch-01",
    dstAssetId: "asset-plc-001",
    protocol: "Unknown",
    port: 0,
    direction: "OT->OT",
    summary: "Switch topology keepalive",
  },
  {
    id: "comm-008",
    ts: hoursAgo(3),
    srcIp: "10.10.14.55",
    dstIp: "192.168.10.2",
    srcAssetId: "asset-eng-03",
    dstAssetId: "asset-switch-01",
    protocol: "Unknown",
    port: 22,
    direction: "IT->OT",
    summary: "Remote switch management",
    bytes: 940,
    packets: 18,
  },
  {
    id: "comm-009",
    ts: hoursAgo(3),
    srcIp: "192.168.10.90",
    dstIp: "192.168.10.12",
    srcAssetId: "asset-unknown-01",
    dstAssetId: "asset-plc-001",
    protocol: "Modbus",
    port: 502,
    direction: "OT->OT",
    summary: "Modbus discovery scan",
    bytes: 340,
    packets: 6,
  },
  {
    id: "comm-010",
    ts: hoursAgo(5),
    srcIp: "10.10.14.21",
    dstIp: "10.40.22.8",
    srcAssetId: "asset-eng-03",
    dstAssetId: "asset-rtu-204",
    protocol: "DNP3",
    port: 20000,
    direction: "IT->OT",
    summary: "DNP3 integrity poll",
    bytes: 1840,
    packets: 14,
  },
  {
    id: "comm-011",
    ts: daysAgo(1),
    srcIp: "192.168.10.44",
    dstIp: "10.10.14.99",
    srcAssetId: "asset-hmi-009",
    dstAssetId: "asset-historian",
    protocol: "OPCUA",
    port: 4840,
    direction: "OT->IT",
    summary: "Operator telemetry sync",
    bytes: 4080,
    packets: 20,
  },
  {
    id: "comm-012",
    ts: daysAgo(2),
    srcIp: "192.168.10.13",
    dstIp: "192.168.10.12",
    srcAssetId: "asset-plc-002",
    dstAssetId: "asset-plc-001",
    protocol: "S7",
    port: 102,
    direction: "OT->OT",
    summary: "PLC peer sync",
  },
];

export const otPcapJobs: OtPcapJob[] = [
  {
    id: "pcap-001",
    filename: "plantwest_capture_0912.pcap",
    uploadedAt: minutesAgo(20),
    status: "running",
    stats: {
      flows: 1240,
      protocols: { Modbus: 320, DNP3: 140, OPCUA: 90 },
      detections: 3,
      assetsDiscovered: 24,
    },
  },
  {
    id: "pcap-002",
    filename: "audit_backup_0901.pcapng",
    uploadedAt: daysAgo(4),
    status: "done",
    stats: {
      flows: 6420,
      protocols: { Modbus: 820, S7: 460, BACnet: 210 },
      detections: 8,
      assetsDiscovered: 112,
    },
  },
  {
    id: "pcap-003",
    filename: "incident_bundle_0831.pcap",
    uploadedAt: daysAgo(12),
    status: "failed",
    stats: {
      flows: 0,
      protocols: {},
      detections: 0,
      assetsDiscovered: 0,
    },
    error: "Corrupted capture file.",
  },
];

export const topProtocols7d: Array<{ protocol: OtProtocol; count: number }> = [
  { protocol: "Modbus", count: 1280 },
  { protocol: "DNP3", count: 680 },
  { protocol: "S7", count: 540 },
  { protocol: "BACnet", count: 410 },
  { protocol: "OPCUA", count: 210 },
];

export const severityCounts = (detections: OtDetection[]): Record<OtSeverity, number> =>
  detections.reduce<Record<OtSeverity, number>>(
    (acc, detection) => {
      acc[detection.severity] += 1;
      return acc;
    },
    { low: 0, med: 0, high: 0, critical: 0 }
  );
